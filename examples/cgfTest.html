<!DOCTYPE html>
<meta charset="utf-8">
<title>CGF Test</title>
<style>
/* CGF Base Styles */
rect.cgf-fill, rect.cgf-stroke {
    fill:   none;
    stroke: none;
}

#example1 svg {
    border: dashed 1px black;
}
</style>
<body>
<script type="text/javascript" src="../package-res/lib/require.js"></script>
<script>
    requirejs.config({
        paths: {
            'ccc': '../bin/stage/ccc/amd',
            'd3':  '../package-res/lib/d3'
        }
    });
</script>
<button id="btnDoIt" disabled>Do it!</button>
<div id="example1"></div>
<script>
require(['ccc/cgf', 'd3'], function(cgf, d3) {

    //setTimeout(doTest2);
    var btn = document.getElementById("btnDoIt");
    btn.removeAttribute("disabled");
    btn.onclick = doTest2;

    function genScenes() {
        var count = 100,
            amplitude = 500,
            scenes = [];

        while(count--) scenes.push({value: Math.random() * amplitude});

        return scenes;
    }

    function doTest() {
        var cat20 = d3.scale.category20();

        var canvas = new cgf.visual.Canvas()
            .size({width: 250, height: 250})
            .padding(10);

        var panel = canvas.add(cgf.visual.Panel)
            .position({left: "10%"})
            .stroke({color: 'red', width: 1});

        var arc = panel.add(cgf.visual.Arc)
            .scenes(function() {
                return [{span: 10}, {span: 20}, {span: 40}, {span: 50}]
            })
            .fill({
                color: function(s, i) {
                    return cat20(i);
                }
            })
            //.radiusInner(0)
            .radiusOuter(50)
            .angleStart(function(s, i) {
                return !i ? 0 : this.parent.content[0][i - 1].angleEnd;
            })
            .angleSpan(function(s, i) {
                return s.span * Math.PI / 180;
            });

        var fill = arc.fill();

        cgf.visual.render(d3.select('#example1'), canvas, {});

        /*
        .pivot("20% 20%")
        */
    }

    function doTest2() {
        var scenes = genScenes();
        var sum = scenes.reduce(function(prev, curr) { return prev + curr.value; }, 0);
        var angleScale = d3.scale.linear()
            .domain([0, sum])
            .range([0, 2 * Math.PI]);

        // -----

        var canvas = new cgf.visual.Canvas({
            size:    {width: 350, height: 350},
            padding: 10,

            content: {
                $type:  cgf.visual.Panel,
                padding: "2%",
                "position.left": "10%",
                fill:   {color: 'palevioletred'},
                stroke: {color: 'green', width: 3},

                content: {
                    $type:  cgf.visual.Arc,
                    scenes: scenes,
                    radiusInner: '30%', // Make a donut
                    angleStart: function(s, i) {
                        return !i ? 0 : this.parent.content[0][i - 1].angleEnd;
                    },
                    angleSpan: function(s) { return angleScale(s.value); }
                }
            }
        });

        cgf.visual.render(d3.select('#example1'), canvas, {});
    }
});
</script>
